{% extends "layouts/app_layout.html" %}

{% block title %}Calendrier des absences - RH{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Calendrier des absences</h1>
            <p class="text-gray-600">Vue d'ensemble des congés de l'équipe</p>
        </div>
        <a href="{% url 'hr:leave_request' %}" class="btn-primary">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Nouvelle demande
        </a>
    </div>

    <!-- Legend -->
    <div class="card">
        <div class="card-body py-3">
            <div class="flex flex-wrap gap-4">
                {% for leave_type in leave_types %}
                <div class="flex items-center">
                    <span class="w-3 h-3 rounded-full mr-2" style="background-color: {{ leave_type.color }}"></span>
                    <span class="text-sm text-gray-600">{{ leave_type.name }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Calendar -->
    <div class="card">
        <div class="card-body">
            <div id="calendar"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'fr',
        firstDay: 1,
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        buttonText: {
            today: "Aujourd'hui",
            month: 'Mois',
            week: 'Semaine',
            list: 'Liste'
        },
        events: '{% url "hr:leave_calendar_events" %}',
        eventClick: function(info) {
            // Could show a modal with details
        },
        eventDidMount: function(info) {
            // Add tooltip
            info.el.title = info.event.extendedProps.employee + ' - ' + info.event.extendedProps.leave_type + ' (' + info.event.extendedProps.days + ' jours)';
        }
    });
    calendar.render();
});
</script>
{% endblock %}
