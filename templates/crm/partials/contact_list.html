{% load humanize permissions_tags %}

{% has_perm "crm_edit" as can_edit %}
{% has_perm "crm_create" as can_create %}

{% if contacts %}
<table class="table">
    <thead>
        <tr>
            <th>Contact</th>
            <th>Entreprise</th>
            <th>Email</th>
            <th>Téléphone</th>
            <th>Catégorie</th>
            <th class="text-right">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for contact in contacts %}
        <tr class="clickable-row" onclick="window.location='{{ contact.get_absolute_url }}'">
            <td>
                <div class="flex items-center">
                    <div class="avatar avatar-md flex-shrink-0">
                        {{ contact.first_name|slice:":1" }}{{ contact.last_name|slice:":1" }}
                    </div>
                    <div class="ml-3">
                        <a href="{{ contact.get_absolute_url }}" class="font-medium text-gray-900 hover:text-primary-600" onclick="event.stopPropagation()">
                            {{ contact.display_name }}
                        </a>
                        {% if contact.job_title %}
                        <p class="text-sm text-gray-500">{{ contact.job_title }}</p>
                        {% endif %}
                    </div>
                </div>
            </td>
            <td>
                {% if contact.company %}
                <a href="{{ contact.company.get_absolute_url }}" class="text-gray-600 hover:text-primary-600" onclick="event.stopPropagation()">
                    {{ contact.company.name }}
                </a>
                {% else %}
                <span class="text-gray-400">-</span>
                {% endif %}
            </td>
            <td>
                {% if contact.email %}
                <a href="mailto:{{ contact.email }}" class="text-gray-600 hover:text-primary-600" onclick="event.stopPropagation()">
                    {{ contact.email }}
                </a>
                {% else %}
                <span class="text-gray-400">-</span>
                {% endif %}
            </td>
            <td>
                {% if contact.phone %}
                <a href="tel:{{ contact.phone }}" class="text-gray-600 hover:text-primary-600" onclick="event.stopPropagation()">
                    {{ contact.phone }}
                </a>
                {% elif contact.mobile %}
                <a href="tel:{{ contact.mobile }}" class="text-gray-600 hover:text-primary-600" onclick="event.stopPropagation()">
                    {{ contact.mobile }}
                </a>
                {% else %}
                <span class="text-gray-400">-</span>
                {% endif %}
            </td>
            <td>
                <span class="badge
                    {% if contact.category == 'CLIENT' %}badge-success
                    {% elif contact.category == 'PROSPECT' %}badge-primary
                    {% elif contact.category == 'PARTNER' %}badge-info
                    {% else %}badge-gray{% endif %}">
                    {{ contact.get_category_display }}
                </span>
            </td>
            <td class="text-right" onclick="event.stopPropagation()">
                <div class="flex items-center justify-end gap-2">
                    <a href="{{ contact.get_absolute_url }}" class="btn-ghost btn-sm" title="Voir">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                    </a>
                    {% if can_edit %}
                    <a href="{% url 'crm:contact_update' contact.pk %}" class="btn-ghost btn-sm" title="Modifier">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                    </a>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% include "components/pagination.html" %}

{% else %}
<div class="empty-state">
    <svg class="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
    </svg>
    <h3 class="empty-state-title">Aucun contact</h3>
    <p class="empty-state-description">Commencez par créer un nouveau contact pour gérer votre relation client.</p>
    {% if can_create %}
    <a href="{% url 'crm:contact_create' %}" class="btn-primary">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Nouveau contact
    </a>
    {% endif %}
</div>
{% endif %}
